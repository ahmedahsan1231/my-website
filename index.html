<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>دردشة حمودي الاجتماعية — WebRTC محلية</title>
<style>
:root{--bg:#0b0b0f;--panel:#111218;--accent:#1db954;--muted:#9aa0a6}
body{margin:0;font-family:'Segoe UI',Tahoma,'Noto Sans Arabic',sans-serif;background:var(--bg);color:#eee}
header{background:linear-gradient(90deg,#0f1720,#0b1220);padding:12px 16px}
.brand{font-weight:700;font-size:18px}
.subtitle{font-size:12px;color:var(--muted)}
main{display:flex;flex-direction:column;gap:10px;padding:12px;max-width:700px;margin:auto}
.video-area{position:relative;background:var(--panel);border-radius:12px;overflow:hidden}
video{width:100%;border-radius:12px;background:#000}
.chat-box{background:var(--panel);border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:6px}
.chat-list{max-height:300px;overflow:auto;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px}
.chat-item{margin-bottom:4px}
.send{display:flex;gap:8px}
input[type=text]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:#fff}
button{background:var(--accent);border:none;color:#fff;padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:600}
button:hover{opacity:0.9}
.small{font-size:12px;color:var(--muted)}
.comment-float{position:absolute;right:10px;top:10px;pointer-events:none}
.comment{background:rgba(255,255,255,0.1);padding:6px 10px;border-radius:999px;margin-top:6px;animation:float 8s linear both}
@keyframes float{0%{transform:translateY(30px);opacity:0}10%{opacity:1}100%{transform:translateY(-120px);opacity:0}}
</style>
</head>
<body>
<header>
  <div class="brand">صفحة حمودي</div>
  <div class="subtitle">دردشة اجتماعية تجريبية (محلية فقط)</div>
</header>

<main>
  <div class="video-area">
    <video id="local" autoplay muted playsinline></video>
    <div class="comment-float" id="float"></div>
  </div>

  <div class="chat-box">
    <div>اسم جهازك: <strong id="devicename">جارٍ التوليد...</strong></div>
    <div class="chat-list" id="chatlist"></div>
    <div class="send">
      <input id="msg" type="text" placeholder="اكتب رسالة..." />
      <button id="send">إرسال</button>
    </div>
    <div class="small">⚠️ هذه نسخة تجريبية محلية فقط، تعمل بدون خادم فعلي.</div>
  </div>
</main>

<script>
function randomName(){
  const ua=navigator.userAgent;
  const m=ua.match(/(SM-|Pixel|iPhone|Windows|Mac)/i);
  const core=(m?m[0]:'جهاز')+Math.random().toString(36).slice(2,5).toUpperCase();
  return core;
}
const nameEl=document.getElementById('devicename');
const deviceName=randomName();
nameEl.textContent=deviceName;

const chatlist=document.getElementById('chatlist');
const msg=document.getElementById('msg');
const send=document.getElementById('send');
const float=document.getElementById('float');
const localV=document.getElementById('local');

async function initCam(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:false});
    localV.srcObject=stream;
  }catch(e){
    console.warn(e);
  }
}
initCam();

function addChat(name,text,showFloat=true){
  const d=document.createElement('div');
  d.className='chat-item';
  d.innerHTML=`<strong>${name}</strong>: ${text}`;
  chatlist.appendChild(d);
  chatlist.scrollTop=chatlist.scrollHeight;

  if(showFloat){
    const f=document.createElement('div');
    f.className='comment';
    f.textContent=`${name}: ${text}`;
    float.appendChild(f);
    setTimeout(()=>f.remove(),8000);
  }
}

send.onclick=()=>{
  const text=msg.value.trim();
  if(!text) return;
  msg.value='';
  addChat(deviceName,text,true);
  // لأن لا يوجد خادم فعلي، نحاكي ردود عشوائية
  setTimeout(()=>{
    const replies=['👍','😂','😮','رائع!','هههه','اتفق','🔥','💬','ممتاز','😎'];
    const random=replies[Math.floor(Math.random()*replies.length)];
    addChat('مستخدم آخر',random,true);
  },1000+Math.random()*2000);
};

msg.addEventListener('keydown',e=>{if(e.key==='Enter')send.click();});
</script>
</body>
  </html>
